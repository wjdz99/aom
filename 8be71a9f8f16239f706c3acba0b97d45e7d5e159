{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8dbb4b86_a9bd390b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 9616
      },
      "writtenOn": "2021-09-04T02:51:17Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThis patch enables FPMT for 3 frames and modifies the computation of \u0027num_fp_contexts\u0027 in av1_compute_num_fp_contexts() to use \u0027max_num_enc_workers\u0027 possible for each resolution. The \u0027workers_per_frame\u0027 computation is tuned to enable higher degrees of FPMT at a lower thread count.\n\nPlease review.\n\nRegards,\nRemya",
      "revId": "8be71a9f8f16239f706c3acba0b97d45e7d5e159",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82d96856_1816f0b8",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 4
      },
      "lineNbr": 877,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-09-07T16:27:21Z",
      "side": 1,
      "message": "This comment needs to be updated?",
      "range": {
        "startLine": 876,
        "startChar": 39,
        "endLine": 877,
        "endChar": 20
      },
      "revId": "8be71a9f8f16239f706c3acba0b97d45e7d5e159",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ce8be3f0_9e75b807",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 4
      },
      "lineNbr": 877,
      "author": {
        "id": 9616
      },
      "writtenOn": "2021-09-08T04:42:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "82d96856_1816f0b8",
      "range": {
        "startLine": 876,
        "startChar": 39,
        "endLine": 877,
        "endChar": 20
      },
      "revId": "8be71a9f8f16239f706c3acba0b97d45e7d5e159",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d5d9aa16_c9ce90e1",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 4
      },
      "lineNbr": 879,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-09-07T16:27:21Z",
      "side": 1,
      "message": "Why is this divided by 4 instead of 3 (3 frames in parallel)?",
      "range": {
        "startLine": 879,
        "startChar": 64,
        "endLine": 879,
        "endChar": 65
      },
      "revId": "8be71a9f8f16239f706c3acba0b97d45e7d5e159",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ab7d9f0_2a561704",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 4
      },
      "lineNbr": 879,
      "author": {
        "id": 9616
      },
      "writtenOn": "2021-09-08T04:42:00Z",
      "side": 1,
      "message": "Hi Yunqing,\n\nThis computation corresponds to the minimum number of workers per frame that can achieve reasonable scaling (derived from empirical results) and is used to determine the no. of parallel frames that can be supported for the configured \u0027max_threads\u0027. The upper bound of 3 (for 3 parallel frames) is applied at line 884. The distribution of workers across parallel frames is  done dynamically based on the actual no. of frames in a given parallel encode set in prepare_fpmt_workers().\n\nRegards,\nRemya",
      "parentUuid": "d5d9aa16_c9ce90e1",
      "range": {
        "startLine": 879,
        "startChar": 64,
        "endLine": 879,
        "endChar": 65
      },
      "revId": "8be71a9f8f16239f706c3acba0b97d45e7d5e159",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0162961a_fe20ac08",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 4
      },
      "lineNbr": 879,
      "author": {
        "id": 5185
      },
      "writtenOn": "2021-09-08T18:01:11Z",
      "side": 1,
      "message": "So used 4 here since maximum number of frames in parallel is 4?",
      "parentUuid": "9ab7d9f0_2a561704",
      "range": {
        "startLine": 879,
        "startChar": 64,
        "endLine": 879,
        "endChar": 65
      },
      "revId": "8be71a9f8f16239f706c3acba0b97d45e7d5e159",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0ad1739_72b34689",
        "filename": "av1/encoder/ethread.c",
        "patchSetId": 4
      },
      "lineNbr": 879,
      "author": {
        "id": 9616
      },
      "writtenOn": "2021-09-09T03:29:11Z",
      "side": 1,
      "message": "Hi Yunqing,\n\n\u0027worker_per_frame\u0027 calculation was modified from 1/2 the max_num_enc_workers to 1/4th the max_num_enc_workers so that FPMT can be enabled with a lower thread count. This is not related to the number of frames in the parallel encode set.\n\nFor e.g. In the case of a 1080p content, max_num_enc_workers \u003d 8. \u0027worker_per_frame\u0027 would be 2 here if taken as 1/4th of max_num_workers (with 0.5 rounding). Hence with minimum 4 threads, FP1 degree 2 can be enabled, with 6 threads FP1 degree 3 can be enabled and with 8 threads FP1 degree 4 can be enabled.\n\nRegards,\nRemya",
      "parentUuid": "0162961a_fe20ac08",
      "range": {
        "startLine": 879,
        "startChar": 64,
        "endLine": 879,
        "endChar": 65
      },
      "revId": "8be71a9f8f16239f706c3acba0b97d45e7d5e159",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}