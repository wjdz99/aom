{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5ba375db_5b392475",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 31592
      },
      "writtenOn": "2023-07-04T10:36:45Z",
      "side": 1,
      "message": "This CL adds AVX2 intrinsic for the `av1_nn_predict()` function and also improves the unit test for better test coverage.\nAs the intrinsic optimization uses floating point operations, outputs are not expected to be the same as C reference. The mismatch is mainly caused by change in order of floating point operations implemented using SIMD instructions. However, we ensured that the error is within the allowed threshold `epsilon \u003d 1e-3f` as set in the unit test. Same threshold is being used in the parent version to test the SSE3 intrinsic.\n\nThe below shows the module level scaling for some of the possible/frequently occurred test cases of encoder. For this AVX2, average ~36% improvements in the scaling number is seen w.r.t. SSE3.\n```\n               Scaling w.r.t. C(x)\nTest-case        SSE3     AVX2\n37x16x24x1       0.98x    3.26x\n24x12x24         2.86x    3.17x\n10x64x16         1.81x    3.53x\n12x32x1          2.45x    2.58x\n18x24x4          0.86x    2.45x\n4x16x1           1.99x    1.55x\n8x16x4           2.05x    2.71x\n8x32x1           2.36x    3.46x\n9x32x3           1.01x    2.04x\n8x8              1.65x    2.10x\n```\n \nThe Borg test results for good encoding mode are below.\n```\n                 Instruction Count        BD-Rate Loss(%)\ncpu   Resolution   Reduction(%)    avg.psnr   ovr.psnr  ssim   \n 5       LOWRES2     0.489         0.0020     0.0010    0.0046  \n 5       MIDRES2     0.418        -0.0023    -0.0024   -0.0021  \n 5        HDRES2     0.365        -0.0074    -0.0156    0.0025  \n 5       Average     0.424        -0.0026    -0.0057    0.0017  \n\n 6       LOWRES2     0.461        -0.0048    -0.0034    0.0129  \n 6       MIDRES2     0.459         0.0024     0.0030    0.0030  \n 6        HDRES2     0.447         0.0030     0.0013    0.0024  \n 6       Average     0.456         0.0002     0.0003    0.0061 \n```\n\nIn the commit message:\n[-] sign indicates encode time increase\n[+] sign indicates encode time reduction\n\nThe instruction count reduction specified has been measured using command:\n`$ perf stat -e instructions:u ./aomenc`",
      "revId": "7f2048be469861ec056ea4d0f577481727143267",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d3b369ae_a4e5e37b",
        "filename": "test/av1_nn_predict_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 211,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-07-05T15:33:47Z",
      "side": 1,
      "message": "\"\u0026\u0026 !CONFIG_EXCLUDE_SIMD_MISMATCH\" should be removed since we are not testing bit exactness here?",
      "range": {
        "startLine": 211,
        "startChar": 13,
        "endLine": 211,
        "endChar": 46
      },
      "revId": "7f2048be469861ec056ea4d0f577481727143267",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "14434d7a_354a73c3",
        "filename": "test/av1_nn_predict_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 211,
      "author": {
        "id": 31592
      },
      "writtenOn": "2023-07-06T14:12:50Z",
      "side": 1,
      "message": "As per our understanding the macro `CONFIG_EXCLUDE_SIMD_MISMATCH` is used to disable\n- SIMD functions that have mismatch between C vs SIMD\n- Unit test corresponding to the SIMD functions\n\nHence, suggested change will result in x86 build failure for unit-test (as the corresponding function declarations are not available, if the macro is enabled).\nWe also noticed that the macro check is required in the NEON unit test below. ARM build for unit test is failing, if the macro is enabled. We shall submit a patch to correct the same.\nPlease let us know your thoughts.",
      "parentUuid": "d3b369ae_a4e5e37b",
      "range": {
        "startLine": 211,
        "startChar": 13,
        "endLine": 211,
        "endChar": 46
      },
      "revId": "7f2048be469861ec056ea4d0f577481727143267",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b8ff5a49_239a2954",
        "filename": "test/av1_nn_predict_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 211,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-07-06T15:47:36Z",
      "side": 1,
      "message": "You are right. Looks like this check is needed. Thanks for taking care of NEON test.",
      "parentUuid": "14434d7a_354a73c3",
      "range": {
        "startLine": 211,
        "startChar": 13,
        "endLine": 211,
        "endChar": 46
      },
      "revId": "7f2048be469861ec056ea4d0f577481727143267",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8d8a68ea_6f336df2",
        "filename": "test/av1_nn_predict_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 211,
      "author": {
        "id": 31592
      },
      "writtenOn": "2023-07-07T12:02:44Z",
      "side": 1,
      "message": "As per the plan, we have submitted a CL to take care of the ARM build failure in NEON unit-test of `NnPredictTest`.\nhttps://aomedia-review.googlesource.com/c/aom/+/177741 \nPlease review the same.",
      "parentUuid": "b8ff5a49_239a2954",
      "range": {
        "startLine": 211,
        "startChar": 13,
        "endLine": 211,
        "endChar": 46
      },
      "revId": "7f2048be469861ec056ea4d0f577481727143267",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "536ff3f5_cabed9e2",
        "filename": "test/av1_nn_predict_test.cc",
        "patchSetId": 4
      },
      "lineNbr": 216,
      "author": {
        "id": 5185
      },
      "writtenOn": "2023-07-05T15:33:47Z",
      "side": 1,
      "message": "same here",
      "range": {
        "startLine": 216,
        "startChar": 14,
        "endLine": 216,
        "endChar": 46
      },
      "revId": "7f2048be469861ec056ea4d0f577481727143267",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ],
  "submitRequirementResults": [
    {
      "submitRequirement": {
        "name": "Code-Review",
        "description": {
          "value": "At least one maximum vote for label \u0027Code-Review\u0027 is required"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Code-Review\u003dMAX,user\u003dnon_uploader AND -label:Code-Review\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1 AND -label:Code-Review\u003dMIN"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Code-Review=MAX,user=non_uploader AND -label:Code-Review=MIN"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["label:Code-Review=MAX,user=non_uploader"],"failingAtoms":["label:Code-Review=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1 AND -label:Code-Review=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1","label:Code-Review=MIN"]}
      },
      "patchSetCommitId": "7f2048be469861ec056ea4d0f577481727143267",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Review-Enforcement",
        "description": {
          "value": "Two Google employees must approve the change. Uploading the change or voting positively on Code-Review count as approval."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "is:review-enforced_gerrit"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:review-enforcement-satisfied_gerrit"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforced_gerrit"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["is:review-enforced_gerrit"],"failingAtoms":[]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforcement-satisfied_gerrit"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforced_gerrit"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["is:review-enforcement-satisfied_gerrit"]}
      },
      "patchSetCommitId": "7f2048be469861ec056ea4d0f577481727143267",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {
        "value": true
      }
    },
    {
      "submitRequirement": {
        "name": "Verified",
        "description": {
          "value": "CI or human verified the change"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Verified\u003dMAX AND -label:Verified\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Verified=MAX AND -label:Verified=MIN"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["label:Verified=MAX"],"failingAtoms":["label:Verified=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1"]}
      },
      "patchSetCommitId": "7f2048be469861ec056ea4d0f577481727143267",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    }
  ]
}