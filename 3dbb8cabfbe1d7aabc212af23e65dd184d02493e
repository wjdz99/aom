{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "19d9c749_9215d83e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-04-28T22:18:24Z",
      "side": 1,
      "message": "I can\u0027t find this CL or commit. Could you post a URL to this CL or commit?",
      "revId": "3dbb8cabfbe1d7aabc212af23e65dd184d02493e",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1809f0c4_78f80b02",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 32097
      },
      "writtenOn": "2023-04-28T23:10:26Z",
      "side": 1,
      "message": "The Gerrit ID comes from this commit: https://aomedia.googlesource.com/aom/+/5d91201069865826bbf253bdf3d3952860a7fedc",
      "parentUuid": "19d9c749_9215d83e",
      "revId": "3dbb8cabfbe1d7aabc212af23e65dd184d02493e",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19023b04_39a9c2fb",
        "filename": "aom_util/aom_thread.h",
        "patchSetId": 2
      },
      "lineNbr": 33,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-04-28T22:18:24Z",
      "side": 1,
      "message": "Hi amyspark,\n\nI built the parent commit (5a87816f2855b0ee7c3af2272fdf40349f51e1b9) of this CL successfully with Visual Studio 2022.\n\nWe define the `NOMINMAX` macro in build/cmake/aom_configure.cmake:\n\n```\nif(AOM_TARGET_SYSTEM STREQUAL \"Windows\")\n  ...\n  # Prevent windows.h from defining the min and max macros. This allows us to\n  # use std::min and std::max.\n  add_compiler_flag_if_supported(\"-DNOMINMAX\")\n  ...\nendif()\n```\n\nCould you find out why that doesn\u0027t work for you?",
      "revId": "3dbb8cabfbe1d7aabc212af23e65dd184d02493e",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e094b31_1c5f7507",
        "filename": "aom_util/aom_thread.h",
        "patchSetId": 2
      },
      "lineNbr": 33,
      "author": {
        "id": 32097
      },
      "writtenOn": "2023-04-28T23:10:26Z",
      "side": 1,
      "message": "Hi,\n\nTo reproduce the error please check out commit 71fc78011a034d42cc9c15a33ee61a81f1ed7eb0 and remove the define in aom_thread.h.\n\nNow, in VS Code with the CMake Tools extension, set your favourite MSVC flavour, then configure aom with\n```\n-DENABLE_EXAMPLES:BOOL\u003dTRUE -DENABLE_TESTDATA:BOOL\u003dFALSE -DENABLE_TESTS:BOOL\u003dTRUE -DENABLE_TOOLS:BOOL\u003dTRUE -DBUILD_SHARED_LIBS:BOOL\u003dFALSE -DCMAKE_C_FLAGS:STRING\u003d-d2SSAOptimizer- -DCMAKE_EXPORT_COMPILE_COMMANDS:BOOL\u003dTRUE -DCMAKE_BUILD_TYPE:STRING\u003dDebug\n```\n\n```json\n    // if you prefer .vscode/settings.json\n    \"cmake.configureSettings\": {\n        \"ENABLE_EXAMPLES\": true,\n        \"ENABLE_TESTDATA\": false,\n        \"ENABLE_TESTS\": true, \n        \"ENABLE_TOOLS\": true,\n        \"BUILD_SHARED_LIBS\": false,\n        \"CMAKE_C_FLAGS\": \"-d2SSAOptimizer-\"\n    },\n```\n\nSwitch the build type to any other. It will trigger a reconfigure. Now, build the tests. It will result in a plethora of complaints from noise_model_test.cc. Checking on the Ninja build rules,\n\n```\nbuild CMakeFiles\\test_aom_encoder.dir\\test\\noise_model_test.cc.obj: CXX_COMPILER__test_aom_encoder_unscanned_RelWithDebInfo E$:\\krita-win\\patches\\aom\\src\\test\\noise_model_test.cc || cmake_object_order_depends_target_test_aom_encoder\n  FLAGS \u003d /DWIN32 /D_WINDOWS /W3 /GR /EHsc /MD /Zi /O2 /Ob1 /DNDEBUG\n```\n  \nYou\u0027re right in that you add the `-DNOMINMAX` flag, but on switching build types the reconfiguration clearly loses them for some reason.",
      "parentUuid": "19023b04_39a9c2fb",
      "revId": "3dbb8cabfbe1d7aabc212af23e65dd184d02493e",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b4e4cc03_1f708288",
        "filename": "aom_util/aom_thread.h",
        "patchSetId": 2
      },
      "lineNbr": 33,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-05-05T00:47:58Z",
      "side": 1,
      "message": "Thank you for the reply. This means the `add_compiler_flag_if_supported` function (used in build/cmake/aom_configure.cmake to add `-DNOMINMAX`) doesn\u0027t work completely when CMake\u0027s Visual Studio generator is used.",
      "parentUuid": "6e094b31_1c5f7507",
      "revId": "3dbb8cabfbe1d7aabc212af23e65dd184d02493e",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6712f2a0_661ee230",
        "filename": "aom_util/aom_thread.h",
        "patchSetId": 2
      },
      "lineNbr": 33,
      "author": {
        "id": 5020
      },
      "writtenOn": "2023-05-05T00:53:16Z",
      "side": 1,
      "message": "\u003e Thank you for the reply. This means the `add_compiler_flag_if_supported` function (used in build/cmake/aom_configure.cmake to add `-DNOMINMAX`) doesn\u0027t work completely when CMake\u0027s Visual Studio generator is used.\n\nThe other flags (_CRT..., etc.) get added I believe, but maybe something is lost in the reconfigure as mentioned. The call to add_compiler_flag_if_supported is a bit unnecessary if we know the compiler, we could just add it directly.",
      "parentUuid": "b4e4cc03_1f708288",
      "revId": "3dbb8cabfbe1d7aabc212af23e65dd184d02493e",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "78590776_606d931f",
        "filename": "aom_util/aom_thread.h",
        "patchSetId": 2
      },
      "lineNbr": 33,
      "author": {
        "id": 9545
      },
      "writtenOn": "2023-05-05T00:57:32Z",
      "side": 1,
      "message": "Yes. By \"not working **completely**\", I meant the flag add_compiler_flag_if_supported added is lost in the reconfigure.",
      "parentUuid": "6712f2a0_661ee230",
      "revId": "3dbb8cabfbe1d7aabc212af23e65dd184d02493e",
      "serverId": "e5514cf8-2d6e-3e29-adb4-24cd6dde4bf0"
    }
  ]
}